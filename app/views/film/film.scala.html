@import com.wizardsofsmart.cineaste.domain.film.{Film, FilmCast, FilmSeries, FilmStaff, FilmStudio}
@import com.wizardsofsmart.cineaste.domain.people.{Person, Group}
@(film: Film, staff: Seq[FilmStaff], cast: Seq[FilmCast], studios: Seq[FilmStudio], series: Option[FilmSeries], synopsis: String)
@views.html.layout.base(Some(film.title)) {
    <h1>@film.title</h1>
    <p>This is the individual film page</p>

        <!-- Poster -->
        <img height="400" width="270" src="@routes.Assets.versioned("images/posters/" + film.uuid + ".jpg")">

        <!-- Japanese Title -->
    @if(film.japaneseTitleUnicode.isDefined && film.japaneseTitleTransliteration.isDefined && film.japaneseTitleTranslation.isDefined) {
        <p>Original title: <i>@Html(film.japaneseTitleUnicode.get)</i></p>
        <p>(<i>@film.japaneseTitleTransliteration.get</i> / <i>@film.japaneseTitleTranslation.get</i>)</p>
    }
        <!-- Aliases -->
    @if(film.aliases.isDefined) {
        <p>Also known as @film.aliases.get.mkString(", ")</p>
    }
        <!-- Release Date -->
    <p>Released @film.displayReleaseDate</p>
        <!-- Studio -->
    @defining(for(studio <- studios) yield studio.name) { studioNames =>
        <p>Produced by @studioNames.mkString(", ")</p>
    }
        <!-- Duration -->
    <p>Duration: @film.duration minutes</p>

        <!-- Series -->
    @if(series.isDefined) {
        @if(series.get.precedent.isDefined) {
            <p>Preceded by @series.get.precedent.get.title</p>
        }
        @if(series.get.antecedent.isDefined) {
            <p>Followed by @series.get.antecedent.get.title</p>
        }
    }

    <hr/>
        <!-- Synopsis modal button -->
    <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#synopsis-modal">
        View spoilerific synopsis
    </button>
    <hr/>

        <!-- Staff -->
    <table>
        <thead>Staff</thead>
        @for(role <- staff) {
            <tr>
                <td style="vertical-align : top">@role.role</td>
                <td>
                @for(person <- role.people) {
                    @if(person.showcase) {
                        @person match {
                            case p: Person => {
                                <a href="@routes.PersonController.person(p.uuid)">@p.displayName</a> <br/>
                            }
                            case g: Group => {
                                <a href="@routes.PersonController.group(g.uuid)">@g.displayName</a> <br/>
                            }
                        }
                    } else {
                        @person.displayName <br/>
                    }
                }
                </td>
            </tr>
        }
    </table>
    <hr/>

        <!-- Top Billed Cast -->
    <table>
        <thead>Cast</thead>
        @defining(cast.filter(_.orders.head < 99)) { billedCast =>
            @for(member <- billedCast) {
                <tr>
                    <td style="vertical-align : top">
                        @if(member.people.showcase) {
                            @member.people match {
                                case p: Person => {
                                    <a href="@routes.PersonController.person(p.uuid)">@p.displayName</a>
                                }
                                case g: Group => {
                                    <a href="@routes.PersonController.group(g.uuid)">@g.displayName</a>
                                }
                            }
                        } else {
                            @member.people.displayName
                        }
                    </td>
                    <td>
                    @for(character <- member.characters) {
                        @character <br/>
                    }
                    </td>
                </tr>
            }
        }
    </table>

        <!-- Uncredited Cast -->
    @defining(cast.filter(_.orders.head == 99)) { uncreditedCast =>
        @if(uncreditedCast.nonEmpty) {
            <table>

                <thead>Uncredited Cast</thead>
                @for(member <- uncreditedCast) {
                    <tr>
                        <td style="vertical-align : top">
                        @if(member.people.showcase) {
                            @member.people match {
                                case p: Person => {
                                    <a href="@routes.PersonController.person(p.uuid)">@p.displayName</a>
                                }
                                case g: Group => {
                                    <a href="@routes.PersonController.group(g.uuid)">@g.displayName</a>
                                }
                            }
                        } else {
                            @member.people.displayName
                        }
                        </td>
                        <td>
                        @for(character <- member.characters) {
                            @character <br/>
                        }
                        </td>
                    </tr>
                }
            </table>
        }
    }
    <hr/>
        <!-- Synopsis modal content -->
    <div class="modal fade" id="synopsis-modal" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Synopsis</h4>
                </div>
                <div class="modal-body">
                @Html(synopsis)
                </div>
            </div>
        </div>
    </div>
}